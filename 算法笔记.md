

# 算法笔记

## Motivation

此帖子用来记录 CV基础知识，对知识点的自我理解，采用问答形式去掌握核心

## 检测基础

### 1. 如何计算mAP?

<u>原理：掌握   代码：了解伪代码</u>

> **问题：**
>
> 1)   AP及mAP 计算过程？
>
> 2）PR曲线如何绘制的，怎么反应模型性能好坏的，怎么找到二者的平衡？
>
> 3)  为何PR曲线中precision 与recall成负相关？

#### **基础概念**

**TP**：正确的检测的数量：正确分类且为正样本/前景（IOU >= threshold)

**FP**：错误的检测的数量：IOU <= threshold

**FN**: 漏检的数量

**TN**: 没有意义。因为我们只关注前景，不会去检测背景的框，没事找事啊

**Precision**: 反应模型找到正确检测框的能力
$$
precision = TP/(TP + FP) = TP/all-detections
$$
**Recall**:反应模型找到所有真实框的能力
$$
Recall = TP/(TP+FN) = TP/all-ground-truths
$$
**AP**: 平均精度，在不同recall下的最高precision的均值(一般会对各类别分别计算各自的AP)。

**mAP**:  平均精度的均值，各类别的AP的均值。

#### AP及mAP计算过程

ap是针对于一个类别，所以以下举其中一类的例子

**第一步：排序**

我们通过inference获得一批检测框(coordinate, score), 数量记作，然后按照类别划分，我们拿出其中一类的检测框，数量记作**n_dets**, 然后根据每个框的socre得分，降序排列，这样就得到一个序列（n_dets, score)。

**第二步：由IOU求TP、FP**

将每个检测框与GT做IOU计算，大于阈值即为TP，小于则为FP，此时已经可以计算出一组precision和recall

**第三步：动态计算precision&recall**

为啥说动态，因为我们调整score的阈值，从小到大依次累加，会影响检测框的总数，所以会得到不同组的precision和recall

这也是我们画PR曲线的基础

第四步：计算AP

voc07:如果按照[VOC07](https://arleyzhang.github.io/articles/1dc20586/)的AP计算标准，对于0.0-1.0的11个Recall阈值(间隔0.1），分别取每个阈值之上的最大Precision进行计算平均值(**11-point interpolation**)

![img](https://camo.githubusercontent.com/dfe080e1379c29387ed57b9ac23e72001a94f0e5b8eb02c69f1d6d3b2161e663/68747470733a2f2f6c617465782e636f6465636f67732e636f6d2f6769662e6c617465783f2535437465787425374241502537442533442535436672616325374231253744253742313125374425323025354373756d5f25374272253543696e2532302535436c65667425323025354325374225323030253243253230302e312532432532302e2e2e25324331253230253543726967687425323025354325374425374425354372686f5f25374225354374657874253742696e746572702537442535436c656674253230253238253230722532302535437269676874253230253239253744)

voc12: AP等于PR曲线的面积（ **interpolating all points**）

#### PR曲线绘制

由上面动态计算得到的Recall & Precision, 我们对应到（x,y)即可绘制出PR曲线。

**PR曲线特点**：

- recall 越小， precision反而越大，二者负相关

  因为如果把score阈值值很高，检测框数量就少(大量漏检），即算precison的分母很小，同时导致TP变小，自然结果值就大。但recall分母是GT的数量，这个是不变的，只有分子(TP)数量提高才能变大。

- 

